<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Profile | NovaStore</title>
<link rel="stylesheet" href="style.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<header class="navbar">
  <div class="logo">Ella's</div>


  <!-- Hamburger -->
  <div class="hamburger" id="hamburger">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <!-- Menu links -->
  <ul class="menu-links" id="menuLinks">
    <li><a href="shop.html">Shop</a></li>
    <li><a href="cart.html">Cart</a></li>
    <li><a href="contact.html">Contact</a></li>
    <li><a href="index.html">Home</a></li>
    <li><a href="profile.html">Profile</a></li>
  </ul>
</header>

<div class="profile-container">
  <h1>Your Profile</h1>
  <img id="profilePic" class="profile-pic" src="" alt="Profile Picture">
  <h2 id="profileName"></h2>
  <p id="profileEmail"></p>

  <div class="profile-info" id="profileInfo"></div>

  <button class="logout-btn" id="logoutBtn">Logout</button>
</div>

<script>
  // Hamburger menu toggle
  const hamburger = document.getElementById("hamburger");
  const menuLinks = document.getElementById("menuLinks");

  hamburger.addEventListener("click", () => {
    menuLinks.classList.toggle("show");
  });
</script>

<script>
  // ====== CONFIG ======
  // Change this to your backend URL (production)
  const API_URL = "https://novastore-production.up.railway.app";

  const profilePic = document.getElementById("profilePic");
  const profileName = document.getElementById("profileName");
  const profileEmail = document.getElementById("profileEmail");
  const profileInfo = document.getElementById("profileInfo");
  const logoutBtn = document.getElementById("logoutBtn");

  // Fetch user info from backend
  async function loadProfile() {
    try {
      const res = await fetch(`${API_URL}/api/auth/status`, {
        method: "GET",
        credentials: "include", // important if backend uses cookies/session
        headers: {
          "Content-Type": "application/json"
        }
      });

      if (!res.ok) throw new Error("Failed to fetch profile");

      const data = await res.json();

      if (!data.loggedIn) {
        window.location.href = "/shop.html"; // redirect if not logged in
        return;
      }

      const user = data.user;
      const info = user._json || user;

      profilePic.src = info.picture || "";
      profileName.textContent = info.name || "";
      profileEmail.textContent = info.email || "";

      profileInfo.innerHTML = `
        <p>First Name: ${info.given_name || "N/A"}</p>
        <p>Last Name: ${info.family_name || "N/A"}</p>
        <p>Email Verified: ${info.email_verified ? "Yes" : "No"}</p>
      `;

    } catch (err) {
      console.error("Error loading profile:", err);
      profileName.textContent = "Failed to load profile";
      profileEmail.textContent = "";
      profileInfo.innerHTML = "";
    }
  }

  loadProfile();

  // Logout
  logoutBtn.onclick = () => {
    window.location.href = `${API_URL}/logout`;
  };
</script>

</body>
</html>
